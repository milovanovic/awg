Arbitrary Waveform Generator (AWG) Chisel Generator
========================================================

## Overview
This repository contains a generator/synthesizer of a parametrizable arbitrary waveforms, written in [Chisel](http://www.chisel-lang.org) hardware design language.

To make a Chisel project and include AWG generator, an open source starter template [Chipyard Framework](http://github.com/ucb-bar/chipyard) can be used.

### Arbitrary Waveform Generator
Arbitrary Waveform Generator relies on two independent submodules described in its own repositories: [PLFG](https://github.com/milovanovic/plfg) and [NCO](https://github.com/milovanovic/nco). 
Arbitrary Waveform Generator is basically a generator of module consisting of arbitrary number of NCOs sourced by the same number of PLFGs. The top module output signal represents the sum of the output signals of all the NCOs instantiated inside it. While doing the addition, an overflow can occur. The user must take care that the sums never exceed the maximum/minimum values for specified data format. The generated module can be used for producing various output signals, such as a simple sine wave, sum of several sine waves or a chirp signal. The generated module has two interfaces: AXI4 Streaming Master Interface for output signal and AXI4 Memory Mapped Interface for writing and reading configurational and control registers used in NCO and PLFG submodules.

This repository also contains the AWG-FFT chain generators. Those generators consist of previously described AWG blocks chained with FFT blocks described in their own repository [SDF-FFT](https://github.com/milovanovic/sdf-fft). 
The latter submodule calculates the FFT of the output signal generated by AWG submodule and sends it to the output. AXI4 Streaming Master Interface is used for the output.

Arbitrary Waveform Generator is described in the following Scala files available inside`src/main/scala` directory:

 - `AWG.scala` - contains a definition of Arbitrary Waveform Generator
 - `AWGUtils.scala` - contains a trait for top module IO pins
 - `AWGFFTChain.scala` - contains an AWG-FFT chain generator where AWG consists of three PLWG-NCO chains
 
### Setting up the parameters

Characteristics of the generated AWG module depend on its input parameters. Every AWG input paramer is described below:

 - `paramsPLFG` - sequence of `PLFGparams[T]` elements which defines the characterists of every instantiated PLFG submodule. It must have the length of `numOfAWGs`
 - `paramsNCO` - sequence of `NCOparams[T]` elements which defines the characterists of every instantiated NCO submodule. It must have the length of `numOfAWGs`. Every NCO submodule is driven by the PLFG submodule with the same index number
 - `csrAddressSetsPLFG` - sequence of address sets for memory-mapped control registers for every PLFG submodule. It must have the length of `numOfAWGs`. Every address set is used by the PLFG submodule with the same index number
 - `csrAddressSetsNCO` - sequence of address sets for memory-mapped control registers for every NCO submodule. It must have the length of `numOfAWGs`. Every address set is used by the NCO submodule with the same index number
 - `ramAddressSets` - sequence of address sets for RAM memories for every PLFG submodule. It must have the length of `numOfAWGs`. Every address set is used by the PLFG submodule with the same index number
 - `numOfAWGs` - number of PLFG-NCO chains used in design
 - `queueSize` - size of the queues storing every NCO's output values while waiting for other NCOs to have valid values on its outputs
 - `beatBytes` - number of data bytes sent in every cycle while performing AXI4 transactions

## Tests

Besides main source code, several tests for AWG generator are provided in this repository. These tests, as well as the other structures needed for running them, are located in `src/test/scala` directory in the following files:
- `AWGSpec.scala` - contains a tester which instantiates and configures an AWG module with two PLWG-NCO chains. The sum of two sine waves with different frequencies and amplitudes is generated on the output. 
Can be run using `testOnly nco.AWGSpec` command
- `AWGFFTChainSpec.scala` - contains a tester which instantiates and configures an AWG-FFT Chain where AWG module consists of three PLWG-NCO chains. FFT values of the sum of three sine waves with different 
frequencies and amplitudes are generated on the output. Can be run using `testOnly nco.AWGFFTChainSpec` command
